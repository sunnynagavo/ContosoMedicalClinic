@page "/staff/dashboard"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Doctor,Staff")]
@inject IAppointmentService AppointmentSvc
@inject IPatientService PatientSvc
@rendermode InteractiveServer

<PageTitle>Staff Dashboard - Contoso Medical Clinic</PageTitle>

<div class="page-content">
    <div class="container">
        <h2 class="section-title mb-4"><i class="bi bi-speedometer2 me-2"></i>Staff Dashboard</h2>

        <!-- KPI Cards -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card kpi-card p-3">
                    <div class="kpi-label">Today's Appointments</div>
                    <div class="kpi-value">@_todayCount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card kpi-card p-3" style="border-left-color: var(--cmc-accent);">
                    <div class="kpi-label">Total Patients</div>
                    <div class="kpi-value">@_patientCount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card kpi-card p-3" style="border-left-color: var(--cmc-success);">
                    <div class="kpi-label">Completed Today</div>
                    <div class="kpi-value">@_completedCount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card kpi-card p-3" style="border-left-color: var(--cmc-warning);">
                    <div class="kpi-label">Pending</div>
                    <div class="kpi-value">@_pendingCount</div>
                </div>
            </div>
        </div>

        <!-- Quick Links -->
        <div class="row g-3">
            <div class="col-md-4">
                <a href="/staff/calendar" class="card p-4 text-decoration-none">
                    <h5 class="fw-bold text-dark"><i class="bi bi-calendar3 text-primary me-2"></i>Appointment Calendar</h5>
                    <p class="text-muted mb-0 small">View and manage all appointments</p>
                </a>
            </div>
            <div class="col-md-4">
                <a href="/staff/patients" class="card p-4 text-decoration-none">
                    <h5 class="fw-bold text-dark"><i class="bi bi-person-lines-fill text-primary me-2"></i>Patient Records</h5>
                    <p class="text-muted mb-0 small">Search and manage patient files</p>
                </a>
            </div>
            <div class="col-md-4">
                <a href="/staff/payments" class="card p-4 text-decoration-none">
                    <h5 class="fw-bold text-dark"><i class="bi bi-credit-card text-primary me-2"></i>Payments</h5>
                    <p class="text-muted mb-0 small">Process and track payments</p>
                </a>
            </div>
        </div>
    </div>
</div>

@code {
    private int _todayCount, _patientCount, _completedCount, _pendingCount;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var appointments = await AppointmentSvc.GetAppointmentsAsync();
            var patients = await PatientSvc.GetPatientsAsync();
            _todayCount = appointments.Count(a => a.AppointmentDate == DateTime.Today.ToString("yyyy-MM-dd"));
            _completedCount = appointments.Count(a => a.Status == "Completed");
            _pendingCount = appointments.Count(a => a.Status == "Scheduled" || a.Status == "Confirmed");
            _patientCount = patients.Count;
        }
        catch { /* Dashboard shows zeros on error */ }
    }
}
