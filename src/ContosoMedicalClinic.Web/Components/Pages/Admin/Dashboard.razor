@page "/admin/dashboard"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@inject IAppointmentService AppointmentSvc
@inject IPatientService PatientSvc
@inject IStaffService StaffSvc
@inject IInvoiceService InvoiceSvc
@rendermode InteractiveServer

<PageTitle>Admin Dashboard - Contoso Medical Clinic</PageTitle>

<div class="page-content">
    <div class="container">
        <h2 class="section-title mb-4"><i class="bi bi-graph-up me-2"></i>Admin Dashboard</h2>

        <!-- KPI Cards -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card kpi-card p-3">
                    <div class="kpi-label">Total Patients</div>
                    <div class="kpi-value">@_patientCount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card kpi-card p-3" style="border-left-color: var(--cmc-accent);">
                    <div class="kpi-label">Staff Members</div>
                    <div class="kpi-value">@_staffCount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card kpi-card p-3" style="border-left-color: var(--cmc-success);">
                    <div class="kpi-label">Total Appointments</div>
                    <div class="kpi-value">@_appointmentCount</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card kpi-card p-3" style="border-left-color: var(--cmc-warning);">
                    <div class="kpi-label">Outstanding Invoices</div>
                    <div class="kpi-value">@_outstandingInvoices</div>
                </div>
            </div>
        </div>

        <!-- Admin Quick Links -->
        <div class="row g-3">
            <div class="col-md-3">
                <a href="/admin/staff" class="card p-4 text-decoration-none text-center">
                    <i class="bi bi-person-badge fs-1 text-primary"></i>
                    <h6 class="fw-bold mt-2 text-dark">Staff Roster</h6>
                </a>
            </div>
            <div class="col-md-3">
                <a href="/admin/shifts" class="card p-4 text-decoration-none text-center">
                    <i class="bi bi-clock-history fs-1 text-primary"></i>
                    <h6 class="fw-bold mt-2 text-dark">Shift Management</h6>
                </a>
            </div>
            <div class="col-md-3">
                <a href="/admin/insurance" class="card p-4 text-decoration-none text-center">
                    <i class="bi bi-shield-check fs-1 text-primary"></i>
                    <h6 class="fw-bold mt-2 text-dark">Insurance</h6>
                </a>
            </div>
            <div class="col-md-3">
                <a href="/admin/services" class="card p-4 text-decoration-none text-center">
                    <i class="bi bi-list-check fs-1 text-primary"></i>
                    <h6 class="fw-bold mt-2 text-dark">Service Catalog</h6>
                </a>
            </div>
        </div>
    </div>
</div>

@code {
    private int _patientCount, _staffCount, _appointmentCount, _outstandingInvoices;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var patients = await PatientSvc.GetPatientsAsync();
            var staff = await StaffSvc.GetStaffAsync();
            var appointments = await AppointmentSvc.GetAppointmentsAsync();
            var invoices = await InvoiceSvc.GetInvoicesAsync();
            _patientCount = patients.Count;
            _staffCount = staff.Count;
            _appointmentCount = appointments.Count;
            _outstandingInvoices = invoices.Count(i => i.Status is "Sent" or "Overdue" or "PartiallyPaid");
        }
        catch { /* Dashboard shows zeros on error */ }
    }
}
